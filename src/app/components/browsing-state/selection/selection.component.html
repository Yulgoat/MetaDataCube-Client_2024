<p class="selection_component_title">
    Selection
</p>

<div class="selection_component_searchbar"> 
    <input type="text" [(ngModel)]="elementToSearch" placeholder="Search..." (input)="search_Elements()" > 
</div>

<button class="clear_selection_component" (click)="clearSelection()"> Clear Selection </button>

<div class="selection_component_labels">

    <!-- Checked items will be displayed at the top (double) to make them easier to find and uncheck. -->
    <div class="checked_all_element" [style.border-bottom]="!(checked_elements.size===0) ? 'solid var(--main-color)' : 'none'">
      <div class="checked_element" *ngFor="let element of checked_elements">
        <ng-container *ngIf="element.type==='tagset'">
          <input type="checkbox" [checked]="element.isCheckedX" (change)="toggleCheckboxX(element)" />
          <input type="checkbox" [checked]="element.isCheckedY" (change)="toggleCheckboxY(element)" />
          <input type="checkbox" [checked]="element.isCheckedFilters" (change)="onTagsetFilterSelected(element)" [style.margin-right]="'50px'" />
        </ng-container>
        <ng-container *ngIf="element.type==='tag'">
          <input type="checkbox" [checked]="element.ischecked" (change)="onTagFilterSelected(element)" [style.margin-right]="'50px'" />
        </ng-container>
        <ng-container *ngIf="element.type==='node'">
          <input type="checkbox" [checked]="element.isCheckedX" [disabled]="!(element.children) || !(element.children.length>0)" (change)="toggleCheckboxX(element)" />
          <input type="checkbox" [checked]="element.isCheckedY" [disabled]="!(element.children) || !(element.children.length>0)" (change)="toggleCheckboxY(element)" />
          <input type="checkbox" [checked]="element.isCheckedFilters" (change)="onNodeFilterSelected(element)" [style.margin-right]="'50px'" />
        </ng-container>
        {{element.name}}
      </div>
    </div>

    <div class="column_title">
      <div>X</div><div>Y</div><div>F</div>
    </div>

    <div class="selection_tagset_labels" *ngFor="let tagset of tagsetlist" >
      <div *ngIf="tagset.isVisible">
        <div class="selection_labels_title">
          <input type="checkbox" [checked]="tagset.isCheckedX" (change)="toggleCheckboxX(tagset)" />
          <input type="checkbox" [checked]="tagset.isCheckedY" (change)="toggleCheckboxY(tagset)"/>
          <input type="checkbox" [checked]="tagset.isCheckedFilters" (change)="onTagsetFilterSelected(tagset)" [style.margin-right]="'50px'"/>
          {{tagset.name}}
        </div>

        <!-- Display tags not present in tagset hierarchy nodes -->
        <div class="selection_tags_labels_div"  *ngIf="tagset.tagList.isVisible">
          <div class="selection_labels_title">
            <span class="toggle-button" (click)="tagset.tagList.isExpanded= !tagset.tagList.isExpanded">{{tagset.tagList.isExpanded ? '-' : '+'}}</span>  
            Tags
          </div>
          <div class="selection_tags_labels" *ngIf="tagset.tagList.isExpanded">
              <app-selection-tag *ngFor="let tag of sortTags(getTagsetTagList(tagset))" [tag]="tag" (isChecked)="onTagFilterSelected($event)"></app-selection-tag>
          </div>  
        </div>

        <div class="selection_hierarchy_labels" *ngFor="let hierarchy of sortHierarchy(tagset.hierarchies)" >
          <div *ngIf="hierarchy.isVisible && hierarchy.firstNode.children && hierarchy.firstNode.children.length > 0">
            <div class="selection_labels_title">
              <input type="checkbox" [checked]="hierarchy.firstNode.isCheckedX" [disabled]="!(hierarchy.firstNode.children.length>0)" (change)="toggleCheckboxX(hierarchy.firstNode)"/>
              <input type="checkbox" [checked]="hierarchy.firstNode.isCheckedY" [disabled]="!(hierarchy.firstNode.children.length>0)" (change)="toggleCheckboxY(hierarchy.firstNode)" />
              <input type="checkbox" [checked]="hierarchy.firstNode.isCheckedFilters" (change)="onNodeFilterSelected(hierarchy.firstNode)" [style.margin-right]="'50px'"/>
                         
              <!-- A button (+ or -) will be displayed depending on whether the element is expanded or not -->
              <span *ngIf="hierarchy.firstNode.children && hierarchy.firstNode.children.length > 0" class="toggle-button" (click)="hierarchy.firstNode.isExpanded = !hierarchy.firstNode.isExpanded">{{hierarchy.firstNode.isExpanded ? '-' : '+'}}</span> 
              {{hierarchy.firstNode.name}}
            </div>
            <ng-container class="selection_childnodes_labels" *ngIf="hierarchy.firstNode.isExpanded">
                <app-selection-node *ngFor="let childNode of sortNodeChildren(hierarchy.firstNode)" [node]="childNode"  [nodegen]="1" (checkX)="toggleCheckboxX($event)" (checkY)="toggleCheckboxY($event)" (checkfilter)="onNodeFilterSelected($event)"></app-selection-node>
            </ng-container>        
          </div> 
        </div>
      </div>    
    </div>

</div>